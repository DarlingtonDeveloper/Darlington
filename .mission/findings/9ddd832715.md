# Summary

Detailed design specifications for all 6 tasks of the MC Dashboard Visibility mission. Each task includes exact file paths, interfaces, component signatures, Tailwind classes, and integration points derived from the existing codebase patterns.

---

## T1: Infrastructure Fixes (`lib/mc/`)

### 1a. Type Changes in `lib/mc/types.ts`

**Add to `WorkerStatus`:**

```ts
export type WorkerStatus =
  | "busy"
  | "idle"
  | "error"
  | "offline"
  | "spawning"
  | "running"
  | "complete"
  | "failed";
```

**Extend `Worker`:**

```ts
export interface Worker {
  id: string;
  persona: string;
  zone: string;
  status: WorkerStatus;
  task: string;
  task_id?: string;
  uptime: number;
  tokens: number;
  cost_usd?: number;
  stdout?: string[];
  started_at?: string; // NEW
  model?: string; // NEW
}
```

**Fix `GateCriteria`:**

```ts
export interface GateCriterion {
  description: string;
  met: boolean;
}

export interface GateCriteria {
  stage: Stage;
  status: "pending" | "approved" | "rejected";
  criteria: GateCriterion[]; // CHANGED from string[]
  approved_at?: string;
  approval_note?: string; // NEW
}
```

**Extend `TokenSummary`:**

```ts
export interface TokenSummary {
  total_tokens: number;
  total_cost: number;
  budget_limit: number;
  budget_used: number;
  budget_remaining: number; // NEW
  sessions: SessionTokens[];
}
```

**Extend `MCState`:**

```ts
export interface MCState {
  stage: { current: Stage };
  tasks: Task[];
  workers: Worker[];
  gates: Record<string, GateCriteria>;
  tokens: TokenSummary;
  connected: boolean;
  audit: AuditEntry[]; // NEW
  checkpoints: CheckpointInfo[]; // NEW
}
```

Update `initialState` in `use-mc-websocket.ts` to include `audit: []` and `checkpoints: []`.

### 1b. New File: `lib/mc/adapters.ts`

```ts
import type {
  Worker,
  GateCriteria,
  GateCriterion,
  TokenSummary,
} from "./types";

interface RawWorker {
  worker_id: string;
  persona: string;
  task_id: string;
  zone: string;
  model: string;
  pid: number;
  status: string;
  started_at: string;
  token_count: number;
  cost_usd: number;
}

interface RawGate {
  stage: string;
  status: string;
  criteria: Array<{ description: string; met: boolean }> | string[];
  approved_at?: string;
  approval_note?: string;
}

interface RawTokens {
  total_tokens: number;
  total_cost_usd: number;
  budget_limit: number;
  budget_used: number;
  budget_remaining: number;
  sessions: unknown[];
}

export function adaptWorker(raw: RawWorker): Worker {
  const now = Date.now();
  const started = raw.started_at ? new Date(raw.started_at).getTime() : now;
  const uptimeSeconds = Math.floor((now - started) / 1000);

  return {
    id: raw.worker_id,
    persona: raw.persona,
    zone: raw.zone,
    status: raw.status as Worker["status"],
    task: raw.task_id,
    task_id: raw.task_id,
    uptime: uptimeSeconds,
    tokens: raw.token_count,
    cost_usd: raw.cost_usd,
    started_at: raw.started_at,
    model: raw.model,
  };
}

export function adaptGate(raw: RawGate): GateCriteria {
  const criteria: GateCriterion[] = Array.isArray(raw.criteria)
    ? raw.criteria.map((c) =>
        typeof c === "string"
          ? { description: c, met: false }
          : { description: c.description, met: c.met },
      )
    : [];

  return {
    stage: raw.stage as GateCriteria["stage"],
    status: raw.status as GateCriteria["status"],
    criteria,
    approved_at: raw.approved_at,
    approval_note: raw.approval_note,
  };
}

export function adaptTokens(raw: RawTokens): TokenSummary {
  return {
    total_tokens: raw.total_tokens,
    total_cost: raw.total_cost_usd,
    budget_limit: raw.budget_limit,
    budget_used: raw.budget_used,
    budget_remaining: raw.budget_remaining,
    sessions: (raw.sessions ?? []) as TokenSummary["sessions"],
  };
}
```

### 1c. WS Handler Additions in `use-mc-websocket.ts`

**Add to the switch statement in `onmessage`:**

```ts
case "audit":
  return {
    ...prev,
    audit: [...prev.audit, event.data as unknown as AuditEntry],
  };
case "checkpoint":
  return {
    ...prev,
    checkpoints: [...prev.checkpoints, event.data as unknown as CheckpointInfo],
  };
case "zone":
  return prev; // no-op, zone metadata not currently rendered
case "chat":
  return prev; // chat uses separate WS connection
```

**Apply adapters in initial_state handler:**

```ts
if (event.topic === "sync" && event.type === "initial_state") {
  const d = event.data as Record<string, unknown>;
  const rawWorkers = d?.workers as RawWorker[] | undefined;
  const rawGates = d?.gates as Record<string, RawGate> | undefined;
  const rawTokens = d?.tokens as RawTokens | undefined;

  setState({
    stage: (d?.stage as MCState["stage"]) ?? initialState.stage,
    tasks: (Array.isArray(d?.tasks) ? d.tasks : []) as Task[],
    workers: rawWorkers ? rawWorkers.map(adaptWorker) : [],
    gates: rawGates
      ? Object.fromEntries(
          Object.entries(rawGates).map(([k, v]) => [k, adaptGate(v)]),
        )
      : {},
    tokens: rawTokens ? adaptTokens(rawTokens) : initialState.tokens,
    connected: true,
    audit: (Array.isArray(d?.audit) ? d.audit : []) as AuditEntry[],
    checkpoints: (Array.isArray(d?.checkpoints)
      ? d.checkpoints
      : []) as CheckpointInfo[],
  });
  return;
}
```

**Note:** Use `setState(newState)` not `setState(prev => ...)` — replace entirely on initial_state to clear stale data.

**Apply adapter in `handleWorkerEvent`:**

```ts
function handleWorkerEvent(prev: MCState, event: MCEvent): MCState {
  const worker = adaptWorker(event.data as unknown as RawWorker);
  // ... rest unchanged, but use worker.id for matching
}
```

**Add `request_sync` on reconnect:**
In `ws.onopen`, after the subscribe message, add:

```ts
ws.send(JSON.stringify({ type: "request_sync" }));
```

### 1d. Acceptance Criteria

- `tsc --noEmit` passes
- All 9 WS topics have handlers (no unhandled default)
- Reconnect sends `request_sync`; `initial_state` replaces (not merges) state

---

## T2: Worker Panel (`components/mc/worker-panel.tsx`)

### Props Interface

```ts
import type { Worker } from "@/lib/mc/types";

interface WorkerPanelProps {
  workers: Worker[];
  onKillWorker: (id: string) => void;
}
```

### Status Badge Mapping

```ts
const STATUS_BADGE: Record<
  string,
  {
    variant: "warning" | "accent" | "success" | "danger" | "default";
    label: string;
  }
> = {
  spawning: { variant: "warning", label: "spawning" },
  running: { variant: "accent", label: "running" },
  busy: { variant: "accent", label: "busy" },
  complete: { variant: "success", label: "complete" },
  failed: { variant: "danger", label: "failed" },
  idle: { variant: "success", label: "idle" },
  error: { variant: "danger", label: "error" },
  offline: { variant: "default", label: "offline" },
};
```

### Layout

```
┌─────────────────────────────────────────┐
│ ◈ Workers                    [+ Spawn]  │
├─────────────────────────────────────────┤
│ ▸ researcher   task-abc123   ● running  │  ← row, click to expand
│   ├ model: claude-opus-4-20250514                │  ← expanded detail
│   ├ zone: backend                       │
│   ├ started: 2m 30s ago                 │
│   ├ tokens: 12.4k  cost: $0.0372       │
│   └ [Kill]                              │
│                                          │
│ ▸ implementer  task-def456   ● spawning │
│ ▸ tester       —             ○ idle     │
├─────────────────────────────────────────┤
│ 2 running · 1 idle · 3 total            │
└─────────────────────────────────────────┘
```

### Component Structure

```tsx
export function WorkerPanel({ workers, onKillWorker }: WorkerPanelProps) {
  const [expanded, setExpanded] = useState<string | null>(null);
  // ... render Card wrapper
}
```

**Outer wrapper:** `<Card className="p-3">`

**Each worker row:**

```tsx
<div
  className="flex items-center gap-2 rounded-md border border-white/[0.04] bg-black/15 p-2 cursor-pointer hover:bg-white/[0.03] transition-colors"
  onClick={() => setExpanded(expanded === w.id ? null : w.id)}
>
  <StatusDot
    status={w.status}
    size={7}
    pulse={w.status === "running" || w.status === "busy"}
  />
  <span className="font-mono text-[11px] font-semibold text-[#e8e4df] w-24 truncate">
    {w.persona}
  </span>
  <span className="font-mono text-[10px] text-[#4a4540] flex-1 truncate">
    {w.task || "—"}
  </span>
  <Badge variant={STATUS_BADGE[w.status]?.variant ?? "default"}>
    {STATUS_BADGE[w.status]?.label ?? w.status}
  </Badge>
</div>
```

**Expanded detail** (shown when `expanded === w.id`):

```tsx
<div className="ml-4 mt-1 mb-2 space-y-0.5 text-[10px] font-mono text-[#6b6560] border-l border-white/[0.06] pl-3">
  <div>
    model: <span className="text-[#a89880]">{w.model ?? "unknown"}</span>
  </div>
  <div>
    zone: <span className="text-[#a89880]">{w.zone}</span>
  </div>
  <div>
    uptime: <span className="text-[#a89880]">{formatUptime(w.uptime)}</span>
  </div>
  <div>
    tokens: <span className="text-[#a89880]">{formatTokens(w.tokens)}</span> ·
    cost:{" "}
    <span className="text-[#c4b5a0]">${(w.cost_usd ?? 0).toFixed(4)}</span>
  </div>
  {(w.status === "running" || w.status === "busy") && (
    <button
      onClick={(e) => {
        e.stopPropagation();
        onKillWorker(w.id);
      }}
      className="mt-1 rounded px-2 py-0.5 text-[10px] font-medium text-red-400 border border-red-400/20 hover:bg-red-400/10 transition-colors"
    >
      Kill Worker
    </button>
  )}
</div>
```

**Footer summary:**

```tsx
<div className="mt-2 flex flex-wrap gap-1.5 border-t border-white/[0.04] pt-2">
  <Badge variant="accent">{runningCount} running</Badge>
  <Badge variant="success">{idleCount} idle</Badge>
  <Badge>{workers.length} total</Badge>
</div>
```

**Empty state:** When `workers.length === 0`:

```tsx
<div className="py-8 text-center text-[11px] font-mono text-[#4a4540]">
  No workers active
</div>
```

**Helper functions:** Reuse `formatUptime` and `formatTokens` from `worker-card.tsx` (extract to a shared util or inline).

---

## T3: Gate Conditions Panel (`components/mc/gate-conditions-panel.tsx`)

### Props Interface

```ts
import type { GateCriteria, Stage } from "@/lib/mc/types";

interface GateConditionsPanelProps {
  gates: Record<string, GateCriteria>;
  currentStage: Stage;
}
```

### Layout

```
┌─────────────────────────────────────────┐
│ Gate Conditions                          │
├─────────────────────────────────────────┤
│ ▾ implement (current)        ● pending  │
│   ✓ All unit tests pass                 │  ← green text-[#4ade80]
│   ✗ Code review complete                │  ← muted text-[#4a4540]
│   ✗ No critical bugs                    │
│                                          │
│ ▸ design                    ● approved  │  ← collapsed, click to expand
│   Approved 2h ago                        │
│   "Looks good, proceed"                 │
│                                          │
│ ▸ requirements              ● approved  │
└─────────────────────────────────────────┘
```

### Component Structure

```tsx
export function GateConditionsPanel({
  gates,
  currentStage,
}: GateConditionsPanelProps) {
  const [expandedStages, setExpandedStages] = useState<Set<string>>(
    new Set([currentStage]),
  );

  const toggleStage = (stage: string) => {
    setExpandedStages((prev) => {
      const next = new Set(prev);
      next.has(stage) ? next.delete(stage) : next.add(stage);
      return next;
    });
  };

  // Sort: current stage first, then by STAGES order
  const sortedGates = Object.values(gates).sort((a, b) => {
    if (a.stage === currentStage) return -1;
    if (b.stage === currentStage) return 1;
    return STAGES.indexOf(a.stage) - STAGES.indexOf(b.stage);
  });
  // ...
}
```

**Stage header row:**

```tsx
<div
  className="flex items-center justify-between cursor-pointer py-1.5 px-2 rounded-md hover:bg-white/[0.02] transition-colors"
  onClick={() => toggleStage(gate.stage)}
>
  <div className="flex items-center gap-2">
    <span className="text-[10px] text-[#4a4540]">{isExpanded ? "▾" : "▸"}</span>
    <span className="font-mono text-[11px] font-semibold text-[#e8e4df]">
      {gate.stage}
    </span>
    {gate.stage === currentStage && (
      <span className="text-[9px] text-[#6b6560] font-mono">(current)</span>
    )}
  </div>
  <Badge
    variant={
      gate.status === "approved"
        ? "success"
        : gate.status === "rejected"
          ? "danger"
          : "default"
    }
  >
    {gate.status}
  </Badge>
</div>
```

**Criteria checklist** (inside expanded section):

```tsx
<div className="ml-5 space-y-1 pb-2">
  {gate.criteria.length === 0 ? (
    <div className="text-[10px] font-mono text-[#4a4540] italic">
      No criteria defined
    </div>
  ) : (
    gate.criteria.map((c, i) => (
      <div key={i} className="flex items-start gap-2 text-[11px] font-mono">
        <span className={c.met ? "text-[#4ade80]" : "text-[#4a4540]"}>
          {c.met ? "✓" : "✗"}
        </span>
        <span className={c.met ? "text-[#a89880]" : "text-[#6b6560]"}>
          {c.description}
        </span>
      </div>
    ))
  )}
  {gate.status === "approved" && gate.approval_note && (
    <div className="mt-1.5 rounded-md bg-[#4ade80]/5 border border-[#4ade80]/10 p-2 text-[10px] font-mono text-[#4ade80]/80">
      "{gate.approval_note}"
      {gate.approved_at && (
        <span className="ml-2 text-[#4a4540]">
          — {new Date(gate.approved_at).toLocaleString()}
        </span>
      )}
    </div>
  )}
</div>
```

---

## T4: Token Usage Panel (`components/mc/token-usage-panel.tsx`)

### Props Interface

```ts
import type { TokenSummary } from "@/lib/mc/types";

interface TokenUsagePanelProps {
  tokens: TokenSummary;
}
```

### Layout

```
┌─────────────────────────────────────────────────┐
│ Token Usage                                      │
├─────────────────────────────────────────────────┤
│ Budget ██████████░░░░░░░░░░ $1.24 / $5.00       │
│                                                   │
│ Worker          In       Out      Cost            │
│ researcher      8.2k     4.1k     $0.0372        │
│ implementer     12.4k    6.8k     $0.0614        │
│ tester          2.1k     1.0k     $0.0091        │
│ ──────────────────────────────────────            │
│ Total           22.7k    11.9k    $0.1077        │
└─────────────────────────────────────────────────┘
```

### Component Structure

```tsx
export function TokenUsagePanel({ tokens }: TokenUsagePanelProps) {
  const { sessions, total_tokens, total_cost, budget_limit, budget_used, budget_remaining } = tokens;
  const budgetPercent = budget_limit > 0 ? Math.min((budget_used / budget_limit) * 100, 100) : 0;
```

**Budget bar:**

```tsx
<div className="space-y-1">
  <div className="flex items-center justify-between text-[10px] font-mono">
    <span className="text-[#6b6560] uppercase tracking-wider">Budget</span>
    <span className="text-[#a89880]">
      ${budget_used.toFixed(2)} / ${budget_limit.toFixed(2)}
    </span>
  </div>
  <div className="h-1.5 rounded-full bg-white/[0.06] overflow-hidden">
    <div
      className={cn(
        "h-full rounded-full transition-all duration-500",
        budgetPercent > 90
          ? "bg-[#f87171]"
          : budgetPercent > 70
            ? "bg-[#fbbf24]"
            : "bg-[#c4b5a0]",
      )}
      style={{ width: `${budgetPercent}%` }}
    />
  </div>
</div>
```

**Session table:**

```tsx
{
  /* Header */
}
<div className="grid grid-cols-[1fr_70px_70px_80px] gap-1 text-[9px] font-mono uppercase tracking-wider text-[#4a4540] border-b border-white/[0.04] pb-1">
  <span>Worker</span>
  <span className="text-right">In</span>
  <span className="text-right">Out</span>
  <span className="text-right">Cost</span>
</div>;

{
  /* Rows */
}
{
  sessions.map((s) => (
    <div
      key={s.worker_id}
      className="grid grid-cols-[1fr_70px_70px_80px] gap-1 text-[10px] font-mono py-0.5"
    >
      <span className="text-[#a89880] truncate">{s.persona}</span>
      <span className="text-right text-[#6b6560]">
        {formatTokens(s.input_tokens)}
      </span>
      <span className="text-right text-[#6b6560]">
        {formatTokens(s.output_tokens)}
      </span>
      <span className="text-right text-[#c4b5a0]">
        ${s.estimated_cost_usd.toFixed(4)}
      </span>
    </div>
  ));
}

{
  /* Total row */
}
<div className="grid grid-cols-[1fr_70px_70px_80px] gap-1 text-[10px] font-mono border-t border-white/[0.06] pt-1 mt-1">
  <span className="text-[#e8e4df] font-semibold">Total</span>
  <span className="text-right text-[#e8e4df]">
    {formatTokens(total_tokens)}
  </span>
  <span className="text-right text-[#6b6560]">—</span>
  <span className="text-right text-[#c4b5a0] font-semibold">
    ${total_cost.toFixed(4)}
  </span>
</div>;
```

**Zero state:**

```tsx
{
  sessions.length === 0 && (
    <div className="py-6 text-center text-[11px] font-mono text-[#4a4540]">
      No token usage yet
    </div>
  );
}
```

### Helper

Reuse `formatTokens` from worker-card pattern:

```ts
function formatTokens(n: number): string {
  if (n >= 1_000_000) return `${(n / 1_000_000).toFixed(1)}M`;
  if (n >= 1_000) return `${(n / 1_000).toFixed(1)}k`;
  return String(n);
}
```

---

## T5: Bridge Status

### 5a. Hook: `lib/mc/use-bridge-status.ts`

```ts
"use client";
import { useState, useEffect, useRef } from "react";
import { MC_API_URL } from "./constants";

interface BridgeStatus {
  connected: boolean;
  loading: boolean;
  error: boolean;
}

export function useBridgeStatus(intervalMs = 10_000): BridgeStatus {
  const [status, setStatus] = useState<BridgeStatus>({
    connected: false,
    loading: true,
    error: false,
  });
  const timerRef = useRef<ReturnType<typeof setInterval> | null>(null);

  useEffect(() => {
    const check = async () => {
      try {
        const res = await fetch(`${MC_API_URL}/api/openclaw/status`, {
          signal: AbortSignal.timeout(5000),
        });
        if (res.ok) {
          const data = await res.json();
          setStatus({
            connected: !!data.connected,
            loading: false,
            error: false,
          });
        } else {
          setStatus({ connected: false, loading: false, error: true });
        }
      } catch {
        setStatus({ connected: false, loading: false, error: true });
      }
    };

    check(); // immediate first check
    timerRef.current = setInterval(check, intervalMs);
    return () => {
      if (timerRef.current) clearInterval(timerRef.current);
    };
  }, [intervalMs]);

  return status;
}
```

### 5b. Component: `components/mc/bridge-status-indicator.tsx`

```tsx
import { useBridgeStatus } from "@/lib/mc/use-bridge-status";

export function BridgeStatusIndicator() {
  const { connected, loading } = useBridgeStatus();

  return (
    <span className="flex items-center gap-1.5">
      <span className="relative inline-flex w-1.5 h-1.5">
        {connected && !loading && (
          <span className="absolute inset-0 rounded-full bg-green-400 opacity-40 animate-ping" />
        )}
        <span
          className={`relative inline-block w-1.5 h-1.5 rounded-full ${
            loading
              ? "bg-[#6b6560]"
              : connected
                ? "bg-green-400"
                : "bg-[#f87171]"
          }`}
        />
      </span>
      <span
        className={`text-[10px] font-mono ${
          loading
            ? "text-[#6b6560]"
            : connected
              ? "text-green-400"
              : "text-[#f87171]"
        }`}
      >
        {loading ? "bridge…" : connected ? "bridge" : "bridge offline"}
      </span>
    </span>
  );
}
```

**Placement:** Next to the existing MC WS connection indicator in `dashboard-header.tsx`, inside the identity/left section.

---

## T6: Integration Spec

### 6a. `components/mc/mission-view.tsx` Changes

**New imports:**

```ts
import { WorkerPanel } from "./worker-panel";
import { GateConditionsPanel } from "./gate-conditions-panel";
import { TokenUsagePanel } from "./token-usage-panel";
```

**New props:**

```ts
interface MissionViewProps {
  workers: Worker[];
  gates: Record<string, GateCriteria>;
  currentStage: Stage;
  tokens: TokenSummary;
  onKillWorker: (id: string) => void;
}
```

**New layout** — 3-column grid replacing current 2-column:

```tsx
<div
  className="grid min-h-[500px] gap-3.5 pt-3"
  style={{
    gridTemplateColumns: "3fr 1.5fr 2fr",
    height: "calc(100vh - 240px)",
  }}
>
  {/* Left: Workers */}
  <WorkerPanel workers={workers} onKillWorker={onKillWorker} />

  {/* Centre: Gate + Tokens stacked */}
  <div className="flex flex-col gap-3 overflow-auto">
    <GateConditionsPanel gates={gates} currentStage={currentStage} />
    <TokenUsagePanel tokens={tokens} />
  </div>

  {/* Right: Kai Chat */}
  <ChatPanel />
</div>
```

### 6b. `components/mc/dashboard-header.tsx` Changes

**Add BridgeStatusIndicator** after the MC connection indicator:

```tsx
import { BridgeStatusIndicator } from "./bridge-status-indicator";

// In the identity left section, after the existing connected/offline span:
<BridgeStatusIndicator />;
```

**Replace hardcoded burn rate** — either compute from token deltas or remove:

```tsx
// Replace:
const burnRate = 142;
// With:
// Remove the BURN stat chip entirely, or display budget_remaining:
<div className="text-right">
  <div className="text-[10px] text-[#6b6560] font-mono tracking-wider">
    LEFT
  </div>
  <div className="text-sm font-semibold text-[#a89880] font-mono">
    ${tokens?.budget_remaining?.toFixed(2) ?? "—"}
  </div>
</div>;
```

**Replace COST computation** — use `total_cost` directly:

```tsx
// Replace formatCost(totalTokens) with:
${(tokens?.total_cost ?? 0).toFixed(4)}
```

### 6c. `app/mc/mc-client.tsx` Changes

**Pass new props to MissionView:**

```tsx
{
  view === "mission" && (
    <MissionView
      workers={mcState.workers}
      gates={mcState.gates}
      currentStage={mcState.stage.current}
      tokens={mcState.tokens}
      onKillWorker={handleKillWorker}
    />
  );
}
```

**Pass audit/checkpoints from MCState to ActivityView:**

```tsx
{
  view === "activity" && (
    <ActivityView
      gates={mcState.gates}
      currentStage={mcState.stage.current}
      audit={mcState.audit}
      workers={mcState.workers}
      tasks={mcState.tasks}
      checkpoints={mcState.checkpoints}
      tokens={mcState.tokens}
      onApproveGate={handleApproveGate}
      onRejectGate={handleRejectGate}
      onCreateCheckpoint={handleCreateCheckpoint}
      onRestoreCheckpoint={handleRestoreCheckpoint}
    />
  );
}
```

### 6d. Shared Utilities

Extract `formatTokens` and `formatUptime` to `lib/mc/format.ts` to avoid duplication across `worker-card.tsx`, `worker-panel.tsx`, `token-usage-panel.tsx`, and `dashboard-header.tsx`:

```ts
export function formatTokens(n: number): string {
  if (n >= 1_000_000) return `${(n / 1_000_000).toFixed(1)}M`;
  if (n >= 1_000) return `${(n / 1_000).toFixed(1)}k`;
  return String(n);
}

export function formatUptime(seconds: number): string {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;
  if (h > 0) return `${h}h ${m}m`;
  return `${m}m ${s}s`;
}
```

---

## File Summary

| Task | File                                        | Action                |
| ---- | ------------------------------------------- | --------------------- |
| T1   | `lib/mc/types.ts`                           | Modify                |
| T1   | `lib/mc/adapters.ts`                        | Create                |
| T1   | `lib/mc/use-mc-websocket.ts`                | Modify                |
| T2   | `components/mc/worker-panel.tsx`            | Create                |
| T3   | `components/mc/gate-conditions-panel.tsx`   | Create                |
| T4   | `components/mc/token-usage-panel.tsx`       | Create                |
| T5   | `lib/mc/use-bridge-status.ts`               | Create                |
| T5   | `components/mc/bridge-status-indicator.tsx` | Create                |
| T6   | `components/mc/mission-view.tsx`            | Modify                |
| T6   | `components/mc/dashboard-header.tsx`        | Modify                |
| T6   | `app/mc/mc-client.tsx`                      | Modify                |
| T6   | `lib/mc/format.ts`                          | Create (shared utils) |

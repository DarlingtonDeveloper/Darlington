# Summary

Implementation plan for MC Dashboard Visibility, organized into 2 waves (6 tasks). Wave 1 tasks are parallel (new files don't conflict). Wave 2 integrates everything.

## Wave 1 — Parallel (no file conflicts)

### T1: Infrastructure Fixes (REQ-5)

**Scope:** `lib/mc/types.ts`, `lib/mc/use-mc-websocket.ts`, `lib/mc/adapters.ts` (new)
**Work:**

- Fix `GateCriteria.criteria` type from `string[]` to `Array<{description:string; met:boolean}>`; add `approval_note?`
- Add `budget_remaining` to `TokenSummary`; add `started_at?`, `model?` to `Worker`
- Add `audit: AuditEntry[]`, `checkpoints: CheckpointInfo[]` to `MCState`
- Create `lib/mc/adapters.ts` with `adaptWorker()`, `adaptTokens()`, `adaptGate()` mappers
- Add WS handlers for `audit`, `checkpoint`, `zone`, `chat` topics
- Add reconnect `request_sync` + stale state clearing on new `initial_state`
- Guard `/api/audit` 404 gracefully
  **AC:** `tsc --noEmit` passes; all 9 WS topics handled; reconnect yields fresh state

### T2: Worker Lifecycle Panel (REQ-1)

**Scope:** `components/mc/worker-panel.tsx` (new)
**Work:**

- Create component showing workers with status badges (spawning=yellow, running=blue, complete=green, failed=red)
- Click-to-expand detail: persona, task link, model, zone, started_at, tokens, cost
- Accepts `workers: Worker[]` prop; uses adapted types from T1
  **AC:** Colour-coded badges; expandable detail rows; handles empty state

### T3: Gate Conditions Panel (REQ-2)

**Scope:** `components/mc/gate-conditions-panel.tsx` (new)
**Work:**

- Checklist UI per stage: ✓ (green) / ✗ (muted) for each criterion
- Show approved/rejected badge, approval_note, approved_at
- Empty criteria → "No criteria defined" placeholder
  **AC:** Per-criterion ✓/✗; badges for approved/rejected; real-time WS updates

### T4: Token Usage Panel (REQ-3)

**Scope:** `components/mc/token-usage-panel.tsx` (new)
**Work:**

- Per-worker table: worker_id, persona, model, input/output/total tokens, cost
- Footer: mission totals + budget progress (used/limit/remaining)
- Zero-state: "No token usage yet"
  **AC:** No hardcoded values; budget bar; handles zero state

### T5: Bridge Status Indicator (REQ-4)

**Scope:** `lib/mc/use-bridge-status.ts` (new), `components/mc/bridge-status-indicator.tsx` (new)
**Work:**

- Hook polls `/api/openclaw/status` every 10s, returns `{connected, loading, error}`
- Component: green StatusDot + "Bridge" or red dot + "Bridge offline"
- Non-blocking initial render
  **AC:** Flips within 10s of bridge stop; uses existing StatusDot

## Wave 2 — Integration (depends on all Wave 1)

### T6: Integrator

**Scope:** `components/mc/mission-view.tsx`, `app/mc/mc-client.tsx`, `components/mc/dashboard-header.tsx`, `components/mc/activity-view.tsx`
**Work:**

- Import and wire WorkerPanel, GateConditionsPanel, TokenUsagePanel into MissionView
- Wire BridgeStatusIndicator into DashboardHeader
- Remove hardcoded token stats from DashboardHeader
- Wire audit/checkpoint state from MCState into ActivityView
- Verify `tsc --noEmit` and dev build pass
  **AC:** All new panels visible; no type errors; no hardcoded data; build clean

## Dependency Graph

```
T1 (infra) ──┐
T2 (worker) ─┤
T3 (gate) ───┼──→ T6 (integrator)
T4 (token) ──┤
T5 (bridge) ─┘
```

Wave 1 tasks are safe to parallelise: T1 modifies existing files, T2-T5 create new files only. T6 touches shared files last.
